<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test</title>
  </head>
  <body>
    <button id="check-approved">Check Approved</button>
    <button id="approve-nft">Approve NFT</button>
    <button id="deposit-nft">Deposit NFT</button>
    <button id="create-fraction">Create Fraction</button>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    const FRACTION_CONTRACT_ADDRESS = "0x06f9FaB6E5B3ed806C5C320380DefE9d8fdDE38b";
    const NFT_CONTRACT_ADDRESS = "0xdD788D42faBb505FA21079f956Ea71e069819996";

    const TOKEN_ID = 2;

    const checkApproved = document.getElementById("check-approved");
    checkApproved.addEventListener("click", async () => {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const abi = ["function getApproved(uint256) view returns (address)"];
      const contract = new ethers.Contract(NFT_CONTRACT_ADDRESS, abi, signer);
      const approvedAddress = await contract.getApproved(TOKEN_ID);
      console.log(approvedAddress, "==", FRACTION_CONTRACT_ADDRESS);
    });

    const approveNFT = document.getElementById("approve-nft");
    approveNFT.addEventListener("click", async () => {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const abi = ["function approve(address, uint256)"];
      const contract = new ethers.Contract(NFT_CONTRACT_ADDRESS, abi, signer);
      const tx = await contract.approve(FRACTION_CONTRACT_ADDRESS, TOKEN_ID, {
        gasLimit: 3000000,
        gasPrice: ethers.utils.parseEther("0.000000003"),
      });
      const receipt = await tx.wait();
      console.log(receipt);
    });

    const depositNFT = document.getElementById("deposit-nft");
    depositNFT.addEventListener("click", async () => {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const abi = ["function depositNft(address, uint256)"];
      const contract = new ethers.Contract(FRACTION_CONTRACT_ADDRESS, abi, signer);
      const tx = await contract.depositNft(NFT_CONTRACT_ADDRESS, TOKEN_ID, {
        gasLimit: 30000000,
        gasPrice: ethers.utils.parseEther("0.000000003"),
      });
      const receipt = await tx.wait();
      console.log(receipt);
    });

    const createFraction = document.getElementById("create-fraction");
    createFraction.addEventListener("click", async () => {
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      const signer = provider.getSigner();
      const abi = [
        "function createFraction(address, uint256, uint256, uint256, string memory, string memory)",
      ];
      const contract = new ethers.Contract(FRACTION_CONTRACT_ADDRESS, abi, signer);
      const args = [
        NFT_CONTRACT_ADDRESS,
        TOKEN_ID,
        15,
        ethers.utils.parseEther("1000000").toString(),
        "BLC",
        "BLC",
      ];
      console.log(args);
      const tx = await contract.createFraction(...args, {
        gasLimit: 30000000,
        gasPrice: ethers.utils.parseEther("0.000000003"),
      });
      console.log(tx);
      const receipt = await tx.wait();
      console.log(receipt);
    });
  </script>
</html>
